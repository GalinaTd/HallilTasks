<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Lesson13</title> 
</head>

<style type="text/css">


     TABLE {
            width:700px;  /*Ширина таблицы */
            border-collapse: collapse; /* Убираем двойные линии между ячейками */
            height: 150px;
    }
    TD, TH {
            padding: 5px; /* Поля вокруг содержимого таблицы */
            border: 1px solid grey;  /*Параметры рамки */
            
    }
    TH {
            background: #b0e0e6; /* Цвет фона */
    }  
    [contenteditable="true"] {
      min-height: 30px;
      font-size: 20px;
      line-height: 30px;     
      margin-bottom: 30px;
      border: 1px solid; 
      width: 500px;     
    }

    button  {
    width: 100%;
    height: 100%;
    text-align: center;  
    border: 1px solid;   
}
   .btnClear{
    width: 100px;
    height: 30px;
    text-align: center;  
    border: 1px solid; 
    background-color: rgba(0, 0, 255, 0.336); 
    color: white; 
   }

   .box{
    width: 600px;     
    float: left;
    display: flex;
    align-items: flex-start;
    margin-right: 15px;
   }
   .clear-fix:after {
            content: ".";
            clear: both;
            display: block;
            height: 0;
            visibility: hidden;
        } 
    form {
            margin-top: 50px;
        }
</style>

<body>
    <h1>Занятие 13. События, работа с формой</h1>
     <!--контейнер для 1-го задания - вирт клавиатура-->       
       <div class="container">
          <div class=box>
            <div class="content" contenteditable="true"></div>
            <button class="btnClear">Очистить</button>
          </div>
          <div class="clear-fix"></div>
          <div class="myTable"></div>        
       </div>

       <form action="" id="form1">
          <p>Я хочу<input name="saleBuy" type="radio" value="0" checked>Продать
          <input name="saleBuy" type="radio" value="1">Купить </p>             
            <p>Валюта из&nbsp;&nbsp;<select name="currencyFrom">
            <option value="USD" selected>USD</option>
            <option value="EUR">EUR</option>
            <option value="UAH">UAH</option>
          </select>
          &nbsp;&nbsp;&nbsp;&nbsp;Валюту в&nbsp;&nbsp; 
          <select name="currencyTo">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="UAH" selected>UAH</option>
          </select></p>
          <p><div class="field">Сумма&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input name="sumInput" type="text" value=""></div></p>
          <div class="field">Результат&nbsp;&nbsp;<input name="resInput" type="text" value="" disabled></div> 
        
       </form>


    <script>
        'use strict';

        const alphabetArr = 'a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,CapsLock,Пробел,!,"'.split(',');

        const codeSymbolObj ={
            33: '!',
            20: 'Caps Lock',           
            34: '"',
            32: 'Пробел'
        };

        const ExchangeRatesArr = [
            ['USD', 27.1410, 27.6620], // покупка,продажа
            ['EUR', 29.1889, 29.9233]  // покупка,продажа          
        ];
        
        const $myTable = document.querySelector('.myTable');
        const $content = document.querySelector('.content');
        
        //по умолчанию капс лок выкл       
        let countCL = 0;
       
        function generateTableData (arr) {
            let htmlTable = `<table>`;
            let tr = `<tr>`;             
                    
                arr.forEach(function (el, ind) {
                    if (ind%13 === 0) {
                        tr +=`</tr><tr><td><button data-action="letter">${el}</button></td>`;
                    } else {
                        tr +=`<td><button data-action="letter">${el}</button></td>`;
                    }                   
                  });               
   
                  tr += `</tr>`;                 
                  
            htmlTable += tr;
            
            htmlTable +=`</table>`;                  
            return htmlTable;              
            }; 

        $myTable.innerHTML = generateTableData(alphabetArr);

                
        document.querySelectorAll('[data-action="letter"]')
           .forEach(function(el) {
              el.addEventListener('click', function () {
                  let str = '';                                       
                if (this.textContent === 'CapsLock'){
                    countCL++;                
             
                } else if (this.textContent === 'Пробел') {
                    $content.innerHTML = $content.innerHTML + ' ';
                } else {

                    if (countCL %2 === 0) {
                        $content.innerHTML = $content.innerHTML + this.textContent.toLowerCase();  
                                              
                    } else {
                        $content.innerHTML = $content.innerHTML + this.textContent.toUpperCase();
                    }  
  
                }
 
              });      
               
           });
           
           // очистка input
           document.querySelector('.btnClear')
            .addEventListener('click', function () {
                $content.innerHTML = '';

            });

           //2 задание конвертер валют        
            let flagSaleBuy = true;  // переключатель продажа/покупка         
               
            document.querySelectorAll('[type="radio"]')
            .forEach(function(el){
                el.addEventListener('click', function () {
                    if (+el.value === 0) {
                        flagSaleBuy = true;  
                    } else {
                        flagSaleBuy = false;
                    }
                    $sumInput.value = '';
                    $resInput.value = '';
                })
            })
           
            //переменные с input сумма и результат
            let $sumInput = document.forms.form1.sumInput;
            let $resInput = document.forms.form1.resInput; 

            //переменным присв выбр значения selected при загрузке формы
            let $currencyFrom = document.forms.form1.currencyFrom.value;
            let $currencyTo = document.forms.form1.currencyTo.value;

            // обработка изм значения в выпад списке валюта из
            document.forms.form1.currencyFrom
                .addEventListener('click', function () {
                     $currencyFrom = this.value;
                     $resInput.value = '';
                     $sumInput.value = '';
            });

            // обработка изм значения в выпад списке валюта в
            document.forms.form1.currencyTo
                .addEventListener('click', function () {
                     $currencyTo = this.value;
                     $resInput.value = '';
                     $sumInput.value = '';
            });
          
            let $res = 0;   //переменная с результатом  
            // обработка ввода суммы и конвертация        
            $sumInput.addEventListener('input', function() {
                let ExchangeInd;
                if (flagSaleBuy) {
                    ExchangeInd = 1;
                } else {
                    ExchangeInd = 2;
                }
                if ($currencyFrom === 'USD' && $currencyTo === 'UAH') {                        
                        $res = +$sumInput.value * ExchangeRatesArr[0][ExchangeInd];
                    } else if ($currencyFrom === 'EUR' && $currencyTo === 'UAH') {
                        $res = +$sumInput.value * ExchangeRatesArr[1][ExchangeInd];                       
                    } else if ($currencyFrom === 'UAH' && $currencyTo === 'USD') {
                        $res = +$sumInput.value / ExchangeRatesArr[0][ExchangeInd];
                    } else if ($currencyFrom === 'UAH' && $currencyTo === 'EUR') {
                        $res = +$sumInput.value / ExchangeRatesArr[1][ExchangeInd];
                    } else if ($currencyFrom === 'USD' && $currencyTo === 'EUR') {
                        $res = +$sumInput.value * ExchangeRatesArr[0][ExchangeInd]/ExchangeRatesArr[1][ExchangeInd];
                    } else if ($currencyFrom === 'EUR' && $currencyTo === 'USD') {
                        $res = +$sumInput.value * ExchangeRatesArr[1][ExchangeInd]/ExchangeRatesArr[0][ExchangeInd];
                    }


                $resInput.value =  $res.toFixed(2);
            });


    </script>

</body>