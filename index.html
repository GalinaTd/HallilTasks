<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Lesson19</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
</head>

<style type="text/css">
    h2 {
        color: Gold;
        background-color: DarkRed;
        width: 300px;
    }

    .list-item {
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        font-size: 18px;
        /*font-weight: bold;*/
    }

    .list-item.active {
        color: blue;
    }

    .list2 {
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        font-size: 16px;        
        display: none;
    }

    div {
        background-color: lightgrey;
        width: 250px;
        margin-left: -30px;
    }
</style>

<body>
    
        <h2>Star Wars. List of films</h2>
        <ul class="list"></ul>
 
    <script>
        'use strict';

        const list = document.querySelector('.list');

        function getSWFilms() {
            return fetch('https://swapi.dev/api/films/', {
                method: 'GET'
            })
                .then(function (response) {
                    return response.json();
                })
        };

        function getSWShip(url) {
            return fetch(url, {
                method: 'GET'
            })
                .then(function (response) {
                    return response.json();
                })

        };

        getSWFilms()
            .then(function (data) {
                data.results.forEach(function (film, index) {

                    const li = document.createElement('li');
                    li.innerHTML = `${film.title} (${film.release_date.substring(0, 4)})`;
                    li.setAttribute('class', 'list-item');
                    list.append(li);


                    const list2 = document.createElement('ul');
                    list2.setAttribute('class', 'list2');

                    const div = document.createElement('div');
                    div.textContent = 'List of starships:';
                    list2.append(div);

                    const li2 = document.createElement('li');
                    for (let i = 0; i < film.starships.length; i++) {

                        const li2 = document.createElement('li');
                        let nameShip = getSWShip(film.starships[i])
                            .then(function (data) {
                                for (let key in data) {
                                    if (key === 'name') {
                                        li2.innerHTML = data[key];
                                    }
                                }

                            })

                        li2.innerHTML = name.nameShip;
                        li2.setAttribute('class', 'list2-item__content');

                        list.append(list2);
                        list2.append(li2);
                    }

                })

            })

       
        $('.list').on('click', '.list-item', function () {

            $('.list-item').removeClass('active');

            $('.list2').not($(this)
                .next())
                .slideUp(1000);

            $(this).addClass('active')
                .next()
                .slideToggle(1000);
        })








    </script>

</body>