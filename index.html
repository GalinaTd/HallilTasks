<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Lesson22</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
</head>

<style type="text/css">
    .tasks-list {
        margin-top: 20px;
    }

    .task-container {
        width: 500px;
        border: 1px solid #000;
        display: table;
        margin-top: 10px;
        background-color: whitesmoke;
    }

    .task-text {
        width: 250px;
        margin: 30px;
        word-wrap: break-word;
        float: left;
    }

    span {
        width: 200px;
    }

    .text-decor {
        text-decoration: line-through;
    }

    .btn1 {
        width: 50px;
        margin-left: 30px;
        border-color: cornflowerblue;
        float: left;
        margin-top: 25px;
        font-weight: bold;
        border-radius: 5px;
    }

    .btn2 {
        width: 50px;
        margin-left: 30px;
        border-color: crimson;
        float: left;
        margin-top: 25px;
        font-weight: bold;
        border-radius: 5px;
    }
</style>

<body>
    <form>
        <h3>ToDo list</h3>
        <input name="task" placeholder="наименование задачи" size="55"></input>
        <button type="submit">Добавить</button>
    </form>
    <div class="tasks-list"></div>

    <script>
        'use strict';

        if (localStorage.storedTasks) {
            printTasks(JSON.parse(localStorage.storedTasks))
        };

        document.forms[0].addEventListener('submit', (e) => {
            e.preventDefault(); //остановка отправки на сервер

            const tasks = localStorage.storedTasks ? JSON.parse(localStorage.storedTasks) : [];
            const task = e.target.elements.task.value;

            tasks.push({
                id: + new (Date),
                task: task,
                status: false
            })
            localStorage.storedTasks = JSON.stringify(tasks);
            printTasks(tasks);
            e.target.reset();
        })

        function printTasks(tasks) {
            let taskList = '';
            tasks.forEach(({ id, task, status }) => {
                taskList += `<div class="task-container">`;
                taskList += `<div class="task-text">`;
                if (status) {
                    taskList += `<span class="text-decor">${task}</span></div>`
                } else {
                    taskList += `<span>${task}</span></div>`
                }
                taskList += `<button id="${id}" type="button" class="btn1" data-action="changeStatus" title="изменить статус">
                +</button>
                <button id="${id}" type="button" class="btn2" data-action="deleteTask" title="удалить задачу">-</button>`
                taskList += '</div>';
            })

            document.querySelector('.tasks-list').innerHTML = taskList;
        }

        // обработка кликов на кнопки внутри списка задач
        const tasksList = document.querySelector('.tasks-list');

        tasksList.addEventListener('click', (e) => {
            const tasksIn = JSON.parse(localStorage.storedTasks);

            tasksIn.forEach((el, ind) => {
                //console.log(el, ind);           
                if (el.id === +e.target.id) {
                    if (e.target.dataset.action === 'changeStatus') {
                        if (el.status) {
                            el.status = false;
                        } else {
                            el.status = true;
                        }

                    } else if (e.target.dataset.action === 'deleteTask') {
                        tasksIn.splice(ind, 1);
                    }
                }
            })

            localStorage.storedTasks = JSON.stringify(tasksIn);
            printTasks(tasksIn);

        })


    </script>


</body>